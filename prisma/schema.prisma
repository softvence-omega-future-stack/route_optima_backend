// Database definition for PostgreSQL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Prisma Client generator
generator client {
  provider = "prisma-client-js"
}

// ------------------------------------
// ENUMS
// ------------------------------------

// Defines the user roles. Only ADMIN is supported as requested.
enum Role {
  ADMIN
  // TECHNICIAN (You might add this if you ever expand the system to allow technicians to log in)
}

// Defines the status of a job, based on the job list screen.
enum JobStatus {
  PENDING
  ASSIGNED
  COMPLETED
}

// ------------------------------------
// AUTHENTICATION MODELS
// ------------------------------------

// The main user model, representing Dispatchers or Administrators.
// All users default to the ADMIN role as requested.
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed password storage
  name      String?  // Name of the Admin/Dispatcher
  role      Role     @default(ADMIN) // Mandatory ADMIN role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationship to tokens/sessions
  sessions Session[]
}

// Model for managing long-term user sessions and tokens.
model Session {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  
  // Storage for authentication tokens
  accessToken   String   // Stores the current access token (for fulfilling the request)
  refreshToken  String   @unique
  expiresAt     DateTime // Expiration date of the refresh token
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ------------------------------------
// APPLICATION MODELS (Based on Screenshots)
// ------------------------------------

// Model for managing field technicians
model Technician {
  id          String    @id @default(cuid())
  name        String
  phone       String?
  region      String?   // E.g., "West Coast", "Midwest"
  workHours   String?   // E.g., "8:00 AM - 6:00 PM"
  isActive    Boolean   @default(true)
  
  // Relationship to jobs assigned to this technician
  jobs        Job[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// Model for predefined work time slots (from Settings screen)
model TimeSlot {
  id          String    @id @default(cuid())
  label       String    // E.g., "8:00 AM - 10:00 AM"
  startTime   String    
  endTime     String

  jobs        Job[]     // Jobs scheduled in this slot
  
  createdAt   DateTime @default(now())
}


// Model for a scheduled job or appointment
model Job {
  id             String      @id @default(cuid())
  customerName   String
  customerPhone  String?
  customerEmail  String?
  jobDescription String?
  
  // Location details
  serviceAddress String
  zipCode        String?
  
  // Scheduling and assignment
  scheduledDate  DateTime    @db.Date
  timeSlotId     String
  timeSlot       TimeSlot    @relation(fields: [timeSlotId], references: [id])
  
  technicianId   String
  technician     Technician  @relation(fields: [technicianId], references: [id])
  
  status         JobStatus   @default(PENDING)
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
}

