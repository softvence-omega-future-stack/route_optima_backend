// Database definition for PostgreSQL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Prisma Client generator
generator client {
  provider = "prisma-client-js"
}

// ------------------------------------
// ENUMS
// ------------------------------------

enum UserRole {
  ADMIN
  TECHNICIAN
}

enum JobStatus {
  PENDING
  ASSIGNED
  COMPLETED
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  photo     String?
  role      UserRole @default(ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  technicianId String?     @unique
  technician   Technician? @relation(fields: [technicianId], references: [id])

  sessions           Session[]
  PasswordResetToken PasswordResetToken[]
}

// Model for managing long-term user sessions and tokens.
model Session {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  refreshToken String?
  expiresAt    DateTime
  isActive     Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
}

// Model for managing field technicians
model Technician {
  id            String  @id @default(uuid())
  name          String
  phone         String  @unique
  address       String?
  photo         String?
  workStartTime String?
  workEndTime   String?
  isActive      Boolean @default(true)

  user User?

  jobs      Job[]
  slots     TimeSlot[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model TimeSlot {
  id        String   @id @default(uuid())
  label     String
  startTime DateTime
  endTime   DateTime
  date      DateTime

  technicianId String
  technician   Technician @relation(fields: [technicianId], references: [id])

  isBooked Boolean @default(false)

  jobs Job[]

  createdAt DateTime @default(now())
}

// Add this new model to your schema

model DefaultTimeSlot {
  id        String   @id @default(uuid())
  label     String
  startTime String   // Format: "08:00" (24-hour format)
  endTime   String   // Format: "10:00" (24-hour format)
  order     Int      @default(autoincrement())
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive, order])
}

// Model for a scheduled job or appointment
model Job {
  id             String  @id @default(uuid())
  customerName   String
  customerPhone  String?
  customerEmail  String?
  jobDescription String?

  // Location details
  serviceAddress String
  zipCode        String?

  latitude  Float?
  longitude Float?
  state     String?

  // Scheduling and assignment
  scheduledDate DateTime
  timeSlotId    String
  timeSlot      TimeSlot @relation(fields: [timeSlotId], references: [id])

  technicianId String
  technician   Technician @relation(fields: [technicianId], references: [id])

  status JobStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
