// Database definition for PostgreSQL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Prisma Client generator
generator client {
  provider = "prisma-client-js"
}

// ------------------------------------
// ENUMS
// ------------------------------------

enum UserRole {
  ADMIN
  TECHNICIAN
}

enum JobStatus {
  PENDING
  ASSIGNED
  COMPLETED
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  technicianId String?     @unique
  technician   Technician? @relation(fields: [technicianId], references: [id])

  // Relationship to tokens/sessions
  sessions Session[]
  @@map("users")
}

// Model for managing long-term user sessions and tokens.
model Session {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  refreshToken String   @unique
  expiresAt    DateTime
  isActive     Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


// Model for managing field technicians
model Technician {
  id        String  @id @default(uuid())
  name      String
  phone     String?
  region    String?
  workHours String?
  isActive  Boolean @default(true)

  user User?

  jobs Job[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model TimeSlot {
  id        String @id @default(uuid())
  label     String // E.g., "8:00 AM - 10:00 AM"
  startTime DateTime
  endTime   DateTime

  jobs Job[] 

  createdAt DateTime @default(now())
}

// Model for a scheduled job or appointment
model Job {
  id             String  @id @default(uuid())
  customerName   String
  customerPhone  String?
  customerEmail  String?
  jobDescription String?

  // Location details
  serviceAddress String
  zipCode        String?

  // Scheduling and assignment
  scheduledDate DateTime 
  timeSlotId    String
  timeSlot      TimeSlot @relation(fields: [timeSlotId], references: [id])

  technicianId String
  technician   Technician @relation(fields: [technicianId], references: [id])

  status JobStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
